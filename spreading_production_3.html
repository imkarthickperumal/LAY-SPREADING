<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lay Spreading</title>
    <!-- Orbitron Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Orbitron", sans-serif;
      }
      tr.dragging {
        opacity: 0.5;
        background: #fef3c7;
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-[url('./assets/home.png')] bg-no-repeat bg-center bg-fixed bg-[length:100%] text-black"
  >
    <!-- Header -->
    <header
      class="flex justify-between items-center text-lg sm:text-2xl md:text-4xl font-extrabold tracking-widest border-b-2 border-black py-4 sm:py-5 px-6"
    >
      <div id="liveClock" class="text-base sm:text-lg md:text-xl font-medium">
        00:00
      </div>

      <div class="text-center flex-1">LAY SPREADING</div>
      <div></div>
    </header>

    <!-- Date Section -->
    <section
      class="flex flex-col sm:flex-row justify-between px-4 sm:px-6 py-2 text-xs sm:text-sm md:text-base font-semibold gap-2"
    >
      <div id="date"></div>
      <div>LAY PLAN - TABLE 1</div>
    </section>

    <!-- Content -->
    <main class="px-6 py-4">
      <div
        class="flex flex-col md:flex-row md:items-start justify-between gap-6"
      >
        <!-- Left Tables (smaller width) -->
        <div class="flex flex-col md:flex-row gap-4 flex-1">
          <!-- First Table -->
          <table class="table-auto w-1/3 p-4 rounded text-left">
            <tbody>
              <tr>
                <td class="font-semibold px-2 py-1">JOB NO</td>
                <td class="px-2 py-1">J6955A</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">MARKER NO</td>
                <td class="px-2 py-1">4980</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">FAB COLOR</td>
                <td class="px-2 py-1">Sky Blue</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">LOT</td>
                <td class="px-2 py-1">1</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">CLR COMBO</td>
                <td class="px-2 py-1">80 / Grey</td>
              </tr>
            </tbody>
          </table>

          <!-- Second Table -->
          <table class="table-auto w-1/3 p-4 rounded text-left">
            <tbody>
              <tr>
                <td class="font-semibold px-2 py-1">PLAN NO</td>
                <td class="px-2 py-1">3260</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">ORDER</td>
                <td class="px-2 py-1">100%</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">TABLE DIA</td>
                <td class="px-2 py-1">59.00</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">CUTTABLE DIA</td>
                <td class="px-2 py-1">56.00</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">PROGRAM DIA</td>
                <td class="px-2 py-1">60</td>
              </tr>
            </tbody>
          </table>

          <!-- Third Table -->
          <table class="table-auto w-1/3 p-4 rounded text-left">
            <tbody>
              <tr>
                <td class="font-semibold px-2 py-1">LAY LENGTH MTR</td>
                <td class="px-2 py-1">7.47</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">PROGRAM WGT</td>
                <td class="px-2 py-1">1.916</td>
              </tr>
              <tr>
                <td class="font-semibold px-2 py-1">AVG WGT</td>
                <td class="px-2 py-1">0.192</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Checklist with gray border and rounded corners -->
        <div
          class="border border-gray-400 rounded-md bg-white/80 px-6 py-4 shadow w-full md:w-96 flex flex-col justify-between"
        >
          <h3 class="text-center font-bold mb-3 text-sm sm:text-base">
            CHECK LIST
          </h3>

          <div class="flex items-center justify-between gap-6 mb-4">
            <!-- Brown Sheet -->
            <div class="flex flex-col items-center">
              <label
                class="flex items-center gap-2 text-xs sm:text-sm font-semibold"
              >
                <input type="checkbox" class="w-4 h-4" id="brownCheck" /> Brown
                Sheet
              </label>
              <span id="brownTimer" class="text-gray-600 text-sm font-bold mt-1"
                >00:00</span
              >
            </div>
            <!-- Join Marker -->
            <div class="flex flex-col items-center">
              <label
                class="flex items-center gap-2 text-xs sm:text-sm font-semibold"
              >
                <input type="checkbox" class="w-4 h-4" id="markerCheck" /> Join
                Marker
              </label>
              <span
                id="markerTimer"
                class="text-gray-600 text-sm font-bold mt-1"
                >00:00</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Next Button aligned right under checklist -->
      <div class="flex justify-end gap-x-2 mt-4">
        <button
          id="rollStatusBtn"
          class="bg-[#429CBE] hover:bg-[#429CBE] text-white font-semibold px-6 py-2 rounded-md shadow cursor-not-allowed"
        >
          Roll Status
        </button>
        <button
          class="bg-[#8AA7B2] hover:bg-[#8AA7B2] text-white font-semibold px-6 py-2 rounded-md shadow"
        >
          Next
        </button>
      </div>
    </main>

    <div
      class="flex justify-end items-center mt-6 border-t border-gray-400 pt-4"
    ></div>

    <div class="p-2 w-full h-screen flex flex-col">
      <!-- Table wrapper -->
      <div class="w-full flex flex-row mb-5">
        <!-- Column 1: Table (takes ~90% width) -->
        <div class="w-11/12 overflow-x-auto">
          <table
            class="min-w-full border-collapse border border-gray-300 text-sm text-center"
          >
            <thead class="bg-gray-100">
              <tr>
                <th class="border border-gray-300 px-2 py-1">S.NO</th>
                <th class="border border-gray-300 px-2 py-1">Roll No</th>
                <th class="border border-gray-300 px-2 py-1">F.DIA</th>
                <th class="border border-gray-300 px-2 py-1">PLAN PLY</th>
                <th class="border border-gray-300 px-2 py-1">PLAN OBWGT</th>
                <th class="border border-gray-300 px-2 py-1">REQD WGT</th>
                <th class="border border-gray-300 px-2 py-1">ACTUAL DIA</th>
                <th class="border border-gray-300 px-2 py-1">ACTUAL PLY</th>
                <th class="border border-gray-300 px-2 py-1">ACTUAL OBWGT</th>
                <th class="border border-gray-300 px-2 py-1">END BIT</th>
                <th class="border border-gray-300 px-2 py-1">BAL WGT</th>
                <th class="border border-gray-300 px-2 py-1">
                  DEB.KG / REMARKS
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="border border-gray-300 px-2 py-1">1</td>
                <td class="border border-gray-300 px-2 py-1">V13184</td>
                <td class="border border-gray-300 px-2 py-1">59.50</td>
                <td class="border border-gray-300 px-2 py-1">11</td>
                <td class="border border-gray-300 px-2 py-1">1.71</td>
                <td class="border border-gray-300 px-2 py-1">18.76</td>
                <td class="border border-gray-300 px-2 py-1">18.76</td>
                <td class="border border-gray-300 px-2 py-1"></td>
                <td class="border border-gray-300 px-2 py-1"></td>
                <td class="border border-gray-300 px-2 py-1"></td>
                <td class="border border-gray-300 px-2 py-1"></td>
                <td class="border border-gray-300 px-2 py-1"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Column 2: Timer (takes ~10% width) -->
        <div class="w-1/12 flex items-center justify-center">
          <p id="row-timer" class="text-black-500 font-bold text-lg">00:00</p>
        </div>
      </div>

      <!-- Save button bottom-right -->
      <div class="flex justify-end mt-5">
        <button
          id="saveBtn"
          class="px-6 py-2 font-bold rounded-lg text-white transition bg-[#8AA7B2] hover:bg-[#78919A]"
        >
          Save
        </button>
      </div>
    </div>

    <!-- Roll Status Modal -->
    <div
      id="rollModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div class="bg-white rounded-md shadow-lg w-96 p-4 relative">
        <h2 class="text-lg font-bold mb-4 text-center">Roll Status</h2>
        <table id="rollTable" class="w-full text-left border border-gray-300">
          <thead>
            <tr class="">
              <th class="px-2 py-1 border">ROLL NO</th>
              <th class="px-2 py-1 border">PLAN PLY</th>
              <th class="px-2 py-1 border">SCAN</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="px-2 py-1 border">V13203</td>
              <td class="px-2 py-1 border">10</td>
              <td class="px-2 py-1 border">
                <img
                  src="assets/qrcode.png"
                  alt="Scan"
                  class="h-10 w-10 object-cover rounded"
                />
              </td>
            </tr>
            <tr>
              <td class="px-2 py-1 border">V13184</td>
              <td class="px-2 py-1 border">11</td>
              <td class="px-2 py-1 border">
                <img
                  src="assets/qrcode.png"
                  alt="Scan"
                  class="h-10 w-10 object-cover rounded"
                />
              </td>
            </tr>
            <tr>
              <td class="px-2 py-1 border">V13218</td>
              <td class="px-2 py-1 border">11</td>
              <td class="px-2 py-1 border">
                <img
                  src="assets/qrcode.png"
                  alt="Scan"
                  class="h-10 w-10 object-cover rounded"
                />
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Cancel Button -->
        <button
          id="closeModal"
          class="absolute top-2 right-2 bg-red-600 text-white font-bold text-xl rounded-full w-10 h-10 flex items-center justify-center hover:bg-red-700"
        >
          ✕
        </button>
      </div>
    </div>

    <!-- Scan Modal -->
    <div
      id="scanModal"
      class="hidden fixed inset-0 z-50 bg-black/60 flex justify-center items-center px-4"
    >
      <div
        class="bg-white rounded-lg p-6 w-full max-w-md md:max-w-lg lg:max-w-xl text-center relative"
      >
        <!-- Close Button -->
        <span
          id="closeScanModal"
          class="absolute top-2 right-3 text-2xl font-bold text-gray-700 cursor-pointer"
          >&times;</span
        >

        <h3 class="mb-4 text-lg md:text-xl font-bold">Scan QR Code</h3>

        <!-- Scanner Preview -->
        <div
          class="w-full h-[250px] border-2 border-dashed border-black flex items-center justify-center text-sm md:text-base text-gray-600 bg-gray-100"
        >
          📷 Camera will open here for scanning...
        </div>

        <!-- Input + Button side by side -->
        <div class="flex flex-wrap gap-2 mt-4">
          <input
            type="text"
            id="scanInput"
            placeholder="Enter or Scan QR code"
            class="flex-1 min-w-[150px] px-4 py-2 border-2 border-[#9fb4bd] rounded-lg focus:border-black focus:ring-2 focus:ring-black/30 outline-none"
          />
          <button
            class="px-6 py-2 bg-[#9fb4bd] text-white font-bold rounded-lg transition hover:bg-black hover:scale-105"
          >
            Scan
          </button>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div
      id="successModal"
      class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden z-50"
    >
      <div
        class="bg-white rounded-lg shadow-lg text-center p-6 w-80 relative border border-green-400"
      >
        <!-- Success Icon -->
        <div class="flex justify-center -mt-12">
          <div
            class="bg-green-500 w-20 h-20 rounded-full flex items-center justify-center shadow-md"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-10 w-10 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="3"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M5 13l4 4L19 7"
              />
            </svg>
          </div>
        </div>

        <!-- Modal Content -->
        <h2 id="successMessage" class="mt-6 text-lg font-bold text-gray-800">
          Data Saved Successfully 👍
        </h2>
        <p id="orderStatus" class="text-gray-600 font-semibold mt-2">
          J6955A Completed
        </p>
        <p id="totalTime" class="text-gray-500 text-sm mt-1">
          Total Time - 00:00
        </p>

        <!-- Close Button -->
        <button
          id="closeSuccessModal"
          class="mt-6 px-4 py-2 rounded-lg bg-green-500 text-white font-semibold hover:bg-green-600 transition"
        >
          Close
        </button>
      </div>
    </div>

    <script>
      const brownCheck = document.getElementById("brownCheck");
      const markerCheck = document.getElementById("markerCheck");
      const brownTimer = document.getElementById("brownTimer");
      const markerTimer = document.getElementById("markerTimer");
      const liveClock = document.getElementById("liveClock");

      const rollModal = document.getElementById("rollModal");
      const rollStatusBtn = document.getElementById("rollStatusBtn");
      const closeModal = document.getElementById("closeModal");

      let timerStart = null;
      let timerInterval = null;
      let activeTimer = null; // "brown" or "marker"

      function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        return `${minutes}:${seconds}`;
      }

      function startTimer(type) {
        activeTimer = type;
        timerStart = Date.now();
        liveClock.textContent = "00:00";
        timerInterval = setInterval(() => {
          liveClock.textContent = formatTime(Date.now() - timerStart);
        }, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
        const elapsed = Date.now() - timerStart;
        return elapsed;
      }

      // Brown Sheet click
      brownCheck.addEventListener("change", () => {
        if (brownCheck.checked) {
          startTimer("brown");
        } else {
          clearInterval(timerInterval);
          liveClock.textContent = "00:00";
        }
      });

      // Join Marker click
      markerCheck.addEventListener("change", () => {
        if (markerCheck.checked) {
          // stop brown sheet timing
          if (activeTimer === "brown") {
            const elapsed = stopTimer();
            brownTimer.textContent = formatTime(elapsed);
          }

          // start marker timing
          startTimer("marker");

          // enable Roll Status button
          rollStatusBtn.disabled = false;
          rollStatusBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
          rollStatusBtn.classList.add("bg-[#429CBE]", "hover:bg-[#429CBE]");
        }
      });

      // Roll Status button
      rollStatusBtn.addEventListener("click", () => {
        if (activeTimer === "marker") {
          const elapsed = stopTimer();
          markerTimer.textContent = formatTime(elapsed);
          liveClock.textContent = "00:00";
          activeTimer = null;
        }

        // keep join marker checked permanently
        markerCheck.checked = true;

        // show modal
        rollModal.classList.remove("hidden");
      });

      // Close modal
      closeModal.addEventListener("click", () => {
        rollModal.classList.add("hidden");
      });

      // Close modal if click outside
      rollModal.addEventListener("click", (e) => {
        if (e.target === rollModal) {
          rollModal.classList.add("hidden");
        }
      });

      // Scan Modal
      const scanModal = document.getElementById("scanModal");
      const closeScanModal = document.getElementById("closeScanModal");

      // Open Scan Modal ONLY when clicking QR images
      document.querySelectorAll("#rollTable td img").forEach((img) => {
        img.addEventListener("click", (e) => {
          e.stopPropagation(); // prevent row click issues
          scanModal.classList.remove("hidden");
        });
      });

      // Close Scan Modal
      closeScanModal.addEventListener("click", () => {
        scanModal.classList.add("hidden");
      });

      // Close on outside click
      scanModal.addEventListener("click", (e) => {
        if (e.target === scanModal) {
          scanModal.classList.add("hidden");
        }
      });
      // -------------------------
      // ✅ Success Modal (Data Saved Successfully)
      const saveBtn = document.getElementById("saveBtn");
      const successModal = document.getElementById("successModal");
      const closeSuccessModal = document.getElementById("closeSuccessModal");

      const successMessage = document.getElementById("successMessage");
      const orderStatus = document.getElementById("orderStatus");
      const totalTime = document.getElementById("totalTime");

      saveBtn.addEventListener("click", () => {
        // set dynamic values
        successMessage.textContent = "Data Saved Successfully 👍";
        orderStatus.textContent = "J6955A Completed";
        totalTime.textContent = "Total Time - 00:45";

        successModal.classList.remove("hidden");
      });

      closeSuccessModal.addEventListener("click", () => {
        successModal.classList.add("hidden");
      });

      successModal.addEventListener("click", (e) => {
        if (e.target === successModal) {
          successModal.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
